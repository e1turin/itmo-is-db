# ITMO University Information Systems &amp; Data Bases Course

Для доступа к БД нужен логин и пaроль, они хранятся в `~/.pgpass`:
```text
[<user-name>@helios ~]$ cat ~/.pgpass
*:*:*:<user-name>:<user-password>
```

## psql

Использовать скрипты можно с помощью стандартной утилиты `psql` в комлекте с
PostgreSQL. Это командная оболочка для работы с базой данных.
- см. https://www.postgresql.org/docs/current/app-psql.html

### Локальное подключение

На Helios, логин и пaроль возьмутся из `~/.pgpass`:
```sh
psql -h pg -d studs
```
- `-h pg` ― это host, адрес в сети, по которому можно достучаться до базы
- `-d studs`― это название базы (есть `studs`, `ucheb`,...)

Если нет `~/.pgpass`, то логин и пaроль нужно ввести самостоятельно с флагом `-U`:
```sh
psql -h pg -d studs -U <user-name>
```
- `-U <user-name>` ― это имя учетной записи, логин с которым можно подключиться к БД

### Удаленное подключение

Так же можно удаленно пользоваться psql, если прокинуть порт на хелиос:
```sh
ssh -L 5432:pg:5432 -p 2222 <user-name>@se.ifmo.ru
```
- `-L <local-address>:<local-port>:<remote-address>:<remote-port>`
- адрес по умолчанию это localhost, который можно не писать.

после этого, psql из комплекта утилит PostgreSQL на локальном компьютере может
подключиться к базе данных:

```sh
psql -h localhost -d studs -U <user-name>
```
- `-h localhost` ― это адрес сервера с PostgreSQL: т.к. мы проблосили порт
  `5432` (дефолтный для PostgreSQL) с `localhost` на удаленный адрес `pg:5432`,
  то сервер доступен на `localhost:5432`
- Кодировка на сервере и на локальной машине могут не совпадать, из-за этого
  могут возникнуть проблемы с отображением кирилических символов
    - исправить наверное можно изменив кодировку терминал (`chcp <code-page>` на Windows: 1251, 65001)

### Исполнение скриптов

Для исполнения целых файлов SQL-скриптов можно использовать команду `psql`:

```psql
\i path/to/file

\include path/to/file
```
- `\i` ― команда для ввода содержимого файла в `psql` (`\?` чтобы увидеть больше команд)
    - `\!` для выполнения команд терминала ОС, в котором запускался `psql`
- `path/to/file` ― это путь до файла, содержимое которого нужно ввести в
  консоль. Это не обязательно должен быть SQL-скрипт, это могут быть и команды
  `psql`

Так же ест возможность указать файл который нужно использовать для исполнения при запуске `psql`:

```sh
psql ... -f script.sql
```

- Если удаленно подключиться к базе данных, то можно использовать скрипнты на
  локальном компьютере, а можно и копировать через `scp` файлы на helios
- Может произойти так, что файл имеет кодировку отличную от кодировки на
  сервере, тогда может произойти ошибка из-за нераспознанных символов, или
  кирилические символы могут неправильно отображаться
- Еще можно использовать стандартный ввод через `<< EOF ...` или с флагом `-c`,
  как указано в документации, но это на мой взгляд не очень удобно


## pgAdmin

Для удобства также можно использовать pgAdmin с графическим UI. В нем можно:
- подключаться к базе данных,
- подключаться по ssh к удаленному серверу,
- загружать скрипты,
- с помощью UI изменять данные,
- не мучиться с кодировками.


## SSH

### ssh-key

Так же может быть удобно создать ssh-ключ для подключение на сервер:
```sh
ssh-keygen
cat ~/.ssh/id_rsa.pub | ssh <remote_username>@helios.se.ifmo.ru 'cat >> .ssh/authorized_keys'
```

### ssh-alias

И удобно настроить алиас на helios `~/.ssh/config` на локальном компьютере:
```.ssh/config
Host helios
	User <remote_username>
	HostName helios.se.ifmo.ru
	Port 2222
	IdentityFile ~/.ssh/id_rsa
```

после этого можно делать так:

```sh
ssh helios
```
